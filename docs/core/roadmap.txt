Perfect choice, brother.
We will now build the Queen Master Roadmap in 5 clean chapters, exactly as you requested â€” each one a self-contained, polished, world-class engineering plan.

Here is how we will proceed:

âœ… PART 3 â€” Roadmap (Split into Chapters)

You will receive 5 separate messages, one for each chapter:
	1.	Part 3.1 â€” Core Roadmap (Stabilize â†’ Expand â†’ Automate â†’ Intelligence)
	2.	Part 3.2 â€” Swing Engine & BTST Engine
	3.	Part 3.3 â€” Indicator Master List
	4.	Part 3.4 â€” Symbol Master Pipeline (NSE+BSE+ISIN)
	5.	Part 3.5 â€” Fundamental Scraper Integration

All in Markdown, all with checkboxes, fully aligned with the files you uploaded and your v10.0 â†’ v11.0 vision.

â¸»

ğŸš€ Starting Now: PART 3.1 â€” CORE ROADMAP

(v9.6 â†’ v10.0 â†’ v10.5 â†’ v11.0)

â¸»

ğŸ“— PART 3.1 â€” CORE ROADMAP (Queen v10.0)

PHASE-1 â€” STABILIZE (Critical)

Make Queen consistent, predictable, stable.

â¸»

1.1 CMP Normalization (Critical)
	â€¢	Create get_cmp(df, live_override) as universal CMP source
	â€¢	Remove CMP override conflicts in:
	â€¢	live.py
	â€¢	cockpit_row.py
	â€¢	scoring engine
	â€¢	bible alignment block
	â€¢	tactical modules
	â€¢	Recompute indicators only when necessary

â¸»

1.2 Indicator Layer Stabilization
	â€¢	Create INDICATOR_SCHEMA (master mapping)
	â€¢	Standardize indicator names:
	â€¢	EMA20 / EMA50 / EMA200
	â€¢	RSI
	â€¢	VWAP
	â€¢	CPR
	â€¢	ATR (daily + intraday)
	â€¢	Unify indicator output structure
	â€¢	Normalize missing-value handling

â¸»

1.3 Bible Engine Cleanup
	â€¢	Merge CPR_Ctx, CPR_Context, cpr_ctx â†’ one key
	â€¢	Merge VWAP_Context, vwap_zone â†’ one key
	â€¢	Fix trade_validity_block dependencies
	â€¢	Make all 5 Bible blocks pure (no cross-dependencies)
	â€¢	Add consistent â€œNear/Choppyâ€ state

â¸»

1.4 Tactical Fusion v1.0 (Critical)
	â€¢	Create tactical_fusion.py
	â€¢	Merge:
	â€¢	divergence
	â€¢	squeeze_pulse
	â€¢	exhaustion
	â€¢	absorption
	â€¢	liquidity_trap
	â€¢	pre_breakout
	â€¢	pattern_tactical_chain
	â€¢	Output a unified tactical_index (0â€“10)
	â€¢	Add a â€œtactical_confidenceâ€ field
	â€¢	Provide a single tactical result consumed by scoring

â¸»

1.5 Scoring Engine v1.0 (Most Important)
	â€¢	Create /queen/scoring/score_engine.py
	â€¢	Inputs:
	â€¢	tactical_index
	â€¢	trend_score
	â€¢	alignment_score
	â€¢	structure_type + confidence
	â€¢	vol_state
	â€¢	risk_rating
	â€¢	early_score
	â€¢	CPR/VWAP reclaim
	â€¢	Outputs:
	â€¢	score (0â€“100)
	â€¢	decision (BUY / WATCH / AVOID)
	â€¢	urgency
	â€¢	notes
	â€¢	conviction
	â€¢	Enforce consistency so Cockpit sorting is stable

â¸»

1.6 Ladder Integration (v1.4)
	â€¢	Merge reversible-runner logic
	â€¢	Preserve WRB memory
	â€¢	Add ladder influence into scoring:
	â€¢	Stage 0â€“6 weighting
	â€¢	Runner-mode boost
	â€¢	Trail SL override
	â€¢	Add Ladder â†’ Alerts integration:
	â€¢	WRB-runner activation alert
	â€¢	Stage shift alert

â¸»

1.7 Actionables Pipeline Rewrite
	â€¢	Split actionables_for() into clean steps:
	â€¢	fetch + df
	â€¢	indicators
	â€¢	bible
	â€¢	tactical
	â€¢	scoring
	â€¢	ladder
	â€¢	cockpit_row adapter
	â€¢	Fix multiple interval logic
	â€¢	Guarantee consistent field names
	â€¢	Add exception guards

â¸»

1.8 Cockpit Schema Freeze (UI Contract)

Backend must always return:
	â€¢	symbol
	â€¢	cmp
	â€¢	score
	â€¢	early
	â€¢	entry
	â€¢	sl
	â€¢	targets_state.*
	â€¢	ladder State (stage, label, WRB, trail_sl)
	â€¢	trend_score
	â€¢	tactical_index
	â€¢	cpr_context
	â€¢	vwap_context
	â€¢	swing flags (later)

UI will become completely stable after this.

â¸»

1.9 Alerts Engine Upgrade
	â€¢	Add tactical alerts
	â€¢	Add breakout alerts
	â€¢	Add WRB/runner alerts
	â€¢	Add CPR/VWAP reclaim alerts
	â€¢	Add ladder stage alerts
	â€¢	Add â€œactionable quality improvementâ€ alerts

â¸»

1.10 Performance Pass
	â€¢	Cache indicators
	â€¢	Cache bible blocks
	â€¢	Cache tactical signals
	â€¢	Parallel universe scanning
	â€¢	Batch indicator processing

â¸»

PHASE-2 â€” EXPAND (v10.3)

Add missing modules + tactical intelligence.

â¸»

2.1 FO Module (Futures & Options)
	â€¢	OI Delta
	â€¢	PCR
	â€¢	IV Capture
	â€¢	FO risk ratings
	â€¢	FO breakout signals
	â€¢	FO-specific universe

â¸»

2.2 Tactical Fusion v2.0
	â€¢	Multi-timeframe fusion (5m+15m+30m)
	â€¢	Pattern confidence
	â€¢	Regime-aware weighting
	â€¢	Order-block & liquidity sweep detection
	â€¢	Smart Divergence v2

â¸»

2.3 Cockpit Enhancements
	â€¢	Heatmap
	â€¢	Radar view
	â€¢	Sparkline mini-charts
	â€¢	Sector filter
	â€¢	Floating cards (persistent pinned symbols)

â¸»

PHASE-3 â€” AUTOMATE (v10.5)

Make Queen â€œrun itselfâ€.

â¸»

3.1 Supervisor v2
	â€¢	Live engine heartbeat
	â€¢	Auto-restart
	â€¢	Crash-localization
	â€¢	Latency alerts

â¸»

3.2 Morning Intel v2
	â€¢	Overnight ranking
	â€¢	Sector momentum
	â€¢	Gap analysis
	â€¢	Pre-market breakout probability

â¸»

3.3 Portfolio Agent
	â€¢	Risk-based sizing
	â€¢	Ladder-aware trailing
	â€¢	Trade quality filters
	â€¢	PnL optimization rules

â¸»

PHASE-4 â€” INTELLIGENCE (v11.0)

Bring AI online.

â¸»

4.1 Cognitive Layer Integration
	â€¢	Meta_Controller
	â€¢	Drift Detector
	â€¢	Cognitive Orchestrator

â¸»

4.2 AI Fusion Model
	â€¢	Predict breakout probability
	â€¢	Predict fakeouts
	â€¢	Predict liquidity trap likelihood

â¸»

4.3 AI Recommender
	â€¢	Recommend top 10 breakout candidates
	â€¢	Label high-probability symbols
	â€¢	Predict best timing window

â¸»

4.4 AI Trainer + Dataset
	â€¢	Auto dataset creation
	â€¢	Auto model training
	â€¢	Auto inference

â¸»

Absolutely brother â€” continuing now.

ğŸ“˜ PART 3.2 â€” Swing Engine & BTST Engine Roadmap

(Markdown + Checkboxes, clean, structured, production-level)

This chapter covers everything in your sections 11.3.1, 11.3.2, and the WRB/pattern system for higher-timeframe trading.

â¸»

ğŸ”µ PART 3.2 â€” SWING ENGINE + BTST ENGINE

Swing = 2â€“20 day horizon
BTST = 1â€“3 day horizon
Both must integrate with:
	â€¢	Daily/Weekly OHLC
	â€¢	Indicators
	â€¢	Bible trend view
	â€¢	Patterns
	â€¢	WRB engine
	â€¢	Universe builder

â¸»

â­ 3.2.1 SWING ENGINE (Daily/Weekly)

Folder: queen/cli/swing_engine.py

âœ”ï¸ A. Create swing_engine.py
	â€¢	Accept inputs:
	â€¢	Daily OHLC (1â€“3 years)
	â€¢	Weekly OHLC
	â€¢	Indicators (daily ATR, daily CPR, EMA20/50/200, swing RSI)
	â€¢	Bible Trend Block (D/W/M)
	â€¢	Pattern Runner (candlestick + composite)
	â€¢	WRB Engine output
	â€¢	Produce outputs:
	â€¢	swing_signal: BUY / ADD / HOLD / TRIM / EXIT
	â€¢	swing_entry
	â€¢	swing_sl (ATR + WRB + structure-based)
	â€¢	swing_targets (T1/T2/T3 based on structure + weekly levels)
	â€¢	holding_horizon (short/mid/long)
	â€¢	swing_score (0â€“100)
	â€¢	conviction label (Low / Medium / High / Very High)

â¸»

â­ 3.2.2 BTST ENGINE (1â€“3 Day)

Folder: queen/cli/btst_engine.py

âœ”ï¸ A. Create btst_engine.py
	â€¢	Accept inputs:
	â€¢	Prev-day intraday data (5m/15m)
	â€¢	Gap context (gap-up/gap-down size, fill zones)
	â€¢	WRB clusters
	â€¢	Patterns (last 3â€“5 candles on daily + intraday)
	â€¢	CPR levels (next day CPR)
	â€¢	VWAP (prev-day + rolling VWAP)
	â€¢	Compute:
	â€¢	gap_strength score
	â€¢	overnight_sentiment score
	â€¢	BTST_probability (0â€“100)
	â€¢	Outputs:
	â€¢	btst_signal: BUY / HOLD / EXIT
	â€¢	btst_entry
	â€¢	btst_sl
	â€¢	btst_targets (1â€“3)

â¸»

ğŸ”µ 3.2.3 Hook Both Into CLI & Router
	â€¢	Build CLI tools:
	â€¢	cli/build_swing_universe.py
	â€¢	cli/build_btst_universe.py
	â€¢	Expose via API:
	â€¢	routers/swing.py
	â€¢	routers/btst.py
	â€¢	Output for Cockpit Swing page

â¸»

ğŸ”¥ 3.2.4 Candlestick Pattern Runner (Critical)

You mentioned:

Confirm pattern runner is wired:
â€¢ core.py
â€¢ composite.py
â€¢ runner.py

âœ”ï¸ Tasks
	â€¢	Validate all pattern files exist and run correctly
	â€¢	Define minimal swing pattern set:
	â€¢	Morning Star
	â€¢	Evening Star
	â€¢	Bullish Engulfing
	â€¢	Bearish Engulfing
	â€¢	Hammer
	â€¢	Shooting Star
	â€¢	Harami (bullish/bearish)
	â€¢	Add pattern confidence scoring
	â€¢	Add pattern reliability per symbol (optional advanced)
	â€¢	Ensure patterns feed into SWING + BTST engines
	â€¢	Build pattern_summary() output schema

â¸»

âš¡ 3.2.5 WRB Engine Integration

You explicitly asked for:

Use WRB engine for breakout confirmation, climax bars, fake-out protection.

âœ”ï¸ Steps
	â€¢	Identify WRB large bars relative to ATR
	â€¢	Mark WRB clusters
	â€¢	Mark WRB exhaustion
	â€¢	Mark WRB climax
	â€¢	WRB-based signals:
	â€¢	Breakout Confirmation = WRB above range
	â€¢	Fake Breakout = WRB up but close inside range
	â€¢	Climax = WRB with large wick + high volume
	â€¢	Swing Exit = WRB negative against trend
	â€¢	Add wrb_context to:
	â€¢	Swing engine
	â€¢	BTST engine
	â€¢	Tactical engine (intraday)

â¸»

â­ 3.2.6 Horizon-Aware Targets & SL

Define rules for SL/Targets:
	â€¢	Swing SL:
	â€¢	Below last WRB
	â€¢	Below CPR
	â€¢	Below Weekly Low
	â€¢	Below structure low
	â€¢	Swing Targets:
	â€¢	T1 = R1 or next swing high
	â€¢	T2 = WRB projection
	â€¢	T3 = Weekly R2 or major level
	â€¢	BTST Targets:
	â€¢	T1 = Gap fill
	â€¢	T2 = Prev-day high
	â€¢	T3 = Structure breakout

â¸»

â­ 3.2.7 Universe Integration

Swing & BTST results must be integrated into:
	â€¢	Cockpit Swing page
	â€¢	Cockpit Summary
	â€¢	API endpoints
	â€¢	Universe builder CLI

â¸»

ğŸ¯ Final Output for Part 3.2

After completing Part 3.2, Queen will have:

ğŸš€ A real Swing Engine

ğŸš€ A real BTST Engine

ğŸš€ Pattern+WRB powered signals

ğŸš€ Multi-horizon confidence scoring

ğŸš€ Target & SL frameworks

ğŸš€ Cockpit integration

ğŸš€ CLI tools for building swing+btst universes

This turns Queen into a multi-timeframe trading platform, not just intraday.

Absolutely brother â€” continuing now.

ğŸ“˜ PART 3.3 â€” INDICATOR LIBRARY MASTER LIST (v10.0)

(Markdown + Checkboxes Â· Clean Â· Structured Â· Precise)

This corresponds to your section 11.5, expanded into a full engineering roadmap.

This chapter defines:
	â€¢	The official indicator registry for all of Queen
	â€¢	Intraday, Swing, Futures (FO) indicator families
	â€¢	Missing indicators to build
	â€¢	Parameter defaults
	â€¢	Internal API for indicator rules
	â€¢	Integration into scoring + Bible

â¸»

ğŸ”µ 3.3. INDICATOR MASTER LIST (v10.0)

Folder: queen/settings/indicators.py
Goal: One centralized, authoritative indicator registry for the entire project.

â¸»

â­ 3.3.1 Create Master Registry

âœ”ï¸ Core Tasks
	â€¢	Build queen/settings/indicators.py
	â€¢	Define each indicator as a structured dict:

INDICATORS = {
    "EMA20":  {"tf": ["intra", "daily"], "default_params": {"period": 20}},
    "RSI14": {"tf": ["intra", "daily"], "default_params": {"period": 14}},
    ...
}

	â€¢	Ensure the following fields exist:
	â€¢	name
	â€¢	category (trend / momentum / volatility / volume / pattern)
	â€¢	applicable_tf (intra / daily / weekly)
	â€¢	default_params
	â€¢	output_schema
	â€¢	dependencies (e.g., ATR needs OHLC)
	â€¢	notes (internal)
	â€¢	Provide helper:

def get_indicator_defaults(ind_name): ...

	â€¢	Ensure evaluator reads defaults when missing.

â¸»

ğŸ”¥ 3.3.2 Indicator Categories

Queen needs three groups:

A) Intraday Core

These are needed for live engine, tactical, ladder, and cockpit:

âœ”ï¸ Trend / Structure
	â€¢	EMA20
	â€¢	EMA50
	â€¢	EMA200
	â€¢	CPR
	â€¢	VWAP (rolling)

âœ”ï¸ Momentum
	â€¢	RSI14
	â€¢	MFI14
	â€¢	MACD (12/26/9)
	â€¢	MACD Histogram

âœ”ï¸ Volatility
	â€¢	ATR14
	â€¢	ATR%
	â€¢	Keltner Channels
	â€¢	Bollinger Bands

âœ”ï¸ Volume / Breadth
	â€¢	OBV
	â€¢	Volume Score
	â€¢	Volume Surge Detector
	â€¢	Liquidity Score
	â€¢	VWMA

âœ”ï¸ Reversal Stack Contributors
	â€¢	Divergence signals
	â€¢	Exhaustion signals
	â€¢	Squeeze (TTM style)
	â€¢	Liquidity Trap
	â€¢	WRB Intensity
	â€¢	WRB Climax

â¸»

B) Swing Core (Daily + Weekly)

âœ”ï¸ Trend + Strength
	â€¢	Daily/Weekly EMA20/50/200
	â€¢	Daily/Weekly CPR
	â€¢	Higher-timeframe VWAP
	â€¢	Structure Highs/Lows (swing detection)

âœ”ï¸ Volatility
	â€¢	Daily ATR
	â€¢	ATR Bands (Weekly)

âœ”ï¸ Patterns
	â€¢	Candlestick patterns:
	â€¢	Morning Star
	â€¢	Evening Star
	â€¢	Hammer / Inverted
	â€¢	Engulfing
	â€¢	Harami
	â€¢	Piercing Line / Dark Cloud
	â€¢	Multi-candle composite patterns
	â€¢	WRB clusters
	â€¢	WRB breakout/fake-out detection

âœ”ï¸ Breadth
	â€¢	Sector breadth
	â€¢	Index breadth
	â€¢	Trend health metrics

â¸»

C) FO (Futures & Options) Core

âœ”ï¸ OI & Derivatives
	â€¢	OI Aggregate
	â€¢	OI Delta
	â€¢	Put/Call Ratio (PCR)
	â€¢	IV (Implied Volatility)
	â€¢	IV Percentile
	â€¢	Max Pain
	â€¢	Long/Short Build-Up Signals

âœ”ï¸ FO Trend Indicators
	â€¢	Futures premium/discount
	â€¢	Roll-over percentage
	â€¢	Volume/Open Interest spikes

â¸»

â­ 3.3.3 Missing Indicators to Implement (High Priority)

Your list includes the following â€” all must be added:

âœ”ï¸ Volume Profile (VP)
	â€¢	POC (Point of Control)
	â€¢	Value Area High (VAH)
	â€¢	Value Area Low (VAL)
	â€¢	HVN/LVN

âœ”ï¸ VDU Detector

(Very Dry Up Volume â€” Bollinger Band contraction combined with low volume)
	â€¢	Rolling volume vs 20-day average
	â€¢	Tag as VDU event
	â€¢	Feed into Swing & BTST engines

âœ”ï¸ WRB Intensity
	â€¢	Bars with range > k Ã— ATR
	â€¢	Climax detection (long upper/lower wicks)
	â€¢	Multi-bar WRB clusters

âœ”ï¸ Breadth Metrics
	â€¢	Count advancing vs declining in universe
	â€¢	Sector-wise trend health
	â€¢	Heatmap scoring (0â€“100)

â¸»

â­ 3.3.4 Integration With Indicator Pipeline

The evaluator should:
	â€¢	Automatically pick default params from Master List
	â€¢	Validate missing indicators gracefully
	â€¢	Run in correct order (e.g., ATR before Keltner)
	â€¢	Attach output into a unified schema

â¸»

â­ 3.3.5 Integration with Tactical + Bible

Bible engine uses:
	â€¢	Structure
	â€¢	Trend
	â€¢	Vol
	â€¢	Risk
	â€¢	Alignment

Indicators must feed:
	â€¢	Trend block (EMA stack, RSI, CPR, VWAP)
	â€¢	Vol block (ATR, ATR%)
	â€¢	Structure block (swing highs/lows, CPR/VWAP proximity)
	â€¢	Trade validity (CPR/VWAP relationships)

Tactical engine uses:
	â€¢	Squeeze
	â€¢	Divergence
	â€¢	Liquidity Trap
	â€¢	WRB
	â€¢	Exhaustion
	â€¢	Momentum scores

All must use indicator registry defaults.

â¸»

â­ 3.3.6 Final Output (Indicator Manifest)

After building this chapter, Queen will have:

âœ”ï¸ A complete indicator registry

âœ”ï¸ Default parameters for all indicators

âœ”ï¸ FO indicators documented

âœ”ï¸ Swing & BTST indicators unified

âœ”ï¸ A foundation for scoring engine v2.0

âœ”ï¸ A future-proof source-of-truth

â¸»
Absolutely brother â€” continuing now with the most important backbone of the entire Queen ecosystem.

This is your section 11.6, expanded and organized into a clean Markdown roadmap with checkboxes.

ğŸ“˜ PART 3.4 â€” SYMBOL MASTER PIPELINE (NSE + BSE + ISIN)

(Markdown Â· Checkboxes Â· Full Architecture Â· Production-Grade)

Queen cannot be stable, scalable, multi-style, or FO-ready without a true symbol master.

This chapter defines:
	â€¢	A complete NSE + BSE + ISINâ€“based master
	â€¢	Full metadata
	â€¢	Universe builders
	â€¢	Tiering system
	â€¢	Quality scores
	â€¢	Integration with fundamentals
	â€¢	CLI tools
	â€¢	Output JSON schemas

Everything your system must have.

â¸»

ğŸ”µ 3.4 SYMBOL MASTER PIPELINE (v10.0)

Primary Folder:
queen/datasets/symbols/
queen/services/universe.py
queen/cli/

Goal:
Create a unified, authoritative, versioned symbol master that powers:
	â€¢	Intraday universe
	â€¢	Swing universe
	â€¢	FO/Derivatives
	â€¢	Sector analysis
	â€¢	Positions + PnL
	â€¢	Alerts
	â€¢	Screening
	â€¢	Fundamental filters
	â€¢	Liquidity scoring

â¸»

â­ 3.4.1 SYMBOL MASTER FROM NSE CSV

âœ”ï¸ Required Input Columns (raw NSE CSV)**
	â€¢	SYMBOL
	â€¢	NAME OF COMPANY
	â€¢	SERIES
	â€¢	DATE OF LISTING
	â€¢	PAID UP VALUE
	â€¢	MARKET LOT
	â€¢	ISIN NUMBER
	â€¢	FACE VALUE

You already have this format â†’ now we formalize its conversion.

â¸»

âœ”ï¸ A. Build master converter

File:
queen/cli/convert_instruments_to_master.py
	â€¢	Load raw NSE CSV
	â€¢	Clean string fields (upper/lower/camel)
	â€¢	Validate ISIN format
	â€¢	Remove special characters in symbol names
	â€¢	Build dict per symbol:

{
  "symbol": "20MICRONS",
  "name": "20 Microns Limited",
  "isin": "INE144J01027",
  "exchange_tag": "NSE_EQ",
  "listing_date": "2008-10-06",
  "series": "EQ",
  "market_lot": 1,
  "face_value": 5,
  "active_flag": true,
  "delisted_flag": false,
  "fo_eligible": false,
  "bse_symbol": null,
  "bse_code": null,
  "sector": "Chemicals",
  "risk_class": "Normal",
  "liquidity_score": 0.83
}


â¸»

â­ 3.4.2 NSE + BSE MERGE LOGIC

âœ”ï¸ Build a merger module

File: queen/cli/build_master_exchange_merge.py
	â€¢	Load NSE master
	â€¢	Load BSE master (if available)
	â€¢	Use ISIN as the primary key
	â€¢	Merge fields:
	â€¢	Map BSE symbol â†’ master
	â€¢	Map BSE code â†’ master
	â€¢	Merge name variants, pick more complete version
	â€¢	Handle duplicates

âœ”ï¸ Add Flags
	â€¢	exchange_tag: NSE_EQ, BSE_EQ, BOTH
	â€¢	active_flag: listed vs suspended
	â€¢	delisted_flag
	â€¢	illiquid_flag (avg vol < threshold)
	â€¢	fo_eligible (from NSE FO list)

âœ”ï¸ Add Derived Fields
	â€¢	liquidity_score
	â€¢	risk_class (Normal / Mid-liquidity / Illiquid)
	â€¢	sector â†’ using sector map files

â¸»

â­ 3.4.3 Save Outputs

âœ”ï¸ Generate cleaned master files
	â€¢	datasets/symbols/master.json (active tradables)
	â€¢	datasets/symbols/master_delisted.json
	â€¢	datasets/symbols/master_illiquid.json
	â€¢	datasets/symbols/fo_list.json

âœ”ï¸ Versioning

Use timestamp or semantic versioning:

master_v2025-11-22.json


â¸»

â­ 3.4.4 Universe Tiering System (Mandatory for Scanners)

âœ”ï¸ Build universe builder

File:
queen/cli/build_intraday_universe.py
queen/cli/build_swing_universe.py

âœ”ï¸ Universe metadata structure

{
  "metadata": {
    "total_symbols": 87,
    "last_updated": "2025-11-11T23:59:59Z",
    "universe_scanned": "NSE All Symbols (~1800)",
    "scoring_methodology": {
      "liquidity": 30,
      "institutional_interest": 25,
      "fundamental_quality": 25,
      "brokerage_coverage": 10,
      "sector_momentum": 10,
      "threshold_tier_1": "85-100",
      "threshold_tier_2": "75-84",
      "threshold_tier_3": "70-74"
    },
    "filters_applied": {
      "beta_min": 1.2,
      "volume_small_cr": 15,
      "volume_mid_cr": 50,
      "volume_large_cr": 200,
      "roe_min_pct": 15,
      "debt_equity_max": 0.5,
      "fii_dii_min_pct": 5
    }
  },
  "tier_1": {
    "intraday": [
      {
        "symbol": "SBIN",
        "ltp": 825,
        "score": 95,
        "beta": 1.32,
        "avg_volume_cr": 2180,
        "roce_pct": 16.8,
        "debt_to_equity": null,
        "fii_dii_pct": 42.3,
        "trading_style": ["intraday"],
        "entry_range": "â‚¹820-830",
        "target_range": "â‚¹840",
        "stop_loss_pct": 0.8,
        "best_time": "09:30-11:30",
        "conviction": "Very High",
        "sector": "Financials",
        "moat": "Largest PSU bank, rate sensitivity"
      }
    ]
  }
}


â¸»

â­ 3.4.5 Universe Scoring Engine (v2)

âœ”ï¸ Scoring components

Each symbol receives a weighted score (0â€“100) based on:
	â€¢	Liquidity (volumes, order-book depth)
	â€¢	Institutional holding (FII + DII)
	â€¢	Fundamental quality (fundamental scraper integration)
	â€¢	Sector momentum
	â€¢	Beta / volatility
	â€¢	Avg intraday range
	â€¢	FO eligibility (boost for large caps)

âœ”ï¸ Universe Tier Rules
	â€¢	Tier 1: score â‰¥ 85
	â€¢	Tier 2: 75â€“84
	â€¢	Tier 3: 70â€“74
	â€¢	Below 70 â†’ Not included

This makes your scanners clean and reliable.

â¸»

â­ 3.4.6 API + Routers Integration

âœ”ï¸ Include new router:

queen/server/routers/universe.py

Endpoints:
	â€¢	/universe/intraday
	â€¢	/universe/swing
	â€¢	/universe/tiers
	â€¢	/universe/master

âœ”ï¸ Cockpit UI Integration
	â€¢	Universe count in status strip
	â€¢	Universe filters in all pages

â¸»

â­ 3.4.7 Cross-System Integration

Symbol master must integrate into:
	â€¢	live.py
	â€¢	bible_engine
	â€¢	tactical pipeline
	â€¢	FO module
	â€¢	Positions/PnL
	â€¢	Cockpit (live/summary/upcoming/analytics)
	â€¢	Scheduler
	â€¢	Alerts system
	â€¢	Universe scanner
	â€¢	Swing & BTST engines

This will eliminate symbol-mismatch bugs, missing series errors, BSE-limited stocks, etc.

â¸»

â­ 3.4.8 Final Output â€” What Queen Gains

After completing Part 3.4:

ğŸš€ A perfect NSE+BSE symbol master

ğŸš€ True ISIN-based deduplication

ğŸš€ FO-ready symbol classification

ğŸš€ Liquidity-aware universe

ğŸš€ Automated universe builders

ğŸš€ Clean symbol metadata for the entire project

ğŸš€ Fully cockpit-integrated universe

â¸»

Absolutely brother â€” continuing now with the final chapter of the roadmap, and one of the most powerful ones for Queen:

ğŸ“˜ PART 3.5 â€” FUNDAMENTAL SCRAPER + INTEGRATION

(Markdown Â· Checkboxes Â· Production-grade Â· Clean Integration Plan)
This corresponds to your detailed section 11.7, expanded into a complete, implementable roadmap.

Queen must combine technicals + fundamentals + liquidity + sector dynamics to build:
	â€¢	Better universes
	â€¢	Better swing/BTST filters
	â€¢	Better conviction
	â€¢	Better long-term signals
	â€¢	Cleaner risk profiling

This chapter defines the entire Fundamental Pipeline.

â¸»

ğŸ”µ 3.5 FUNDAMENTAL SCRAPER & QUALITY ENGINE (v10.0)

Primary Folders:
	â€¢	queen/scrapers/
	â€¢	datasets/fundamentals/raw/
	â€¢	datasets/fundamentals/processed/
	â€¢	queen/services/fundamental_engine.py
	â€¢	queen/cli/build_fundamentals.py
	â€¢	queen/cli/merge_fundamentals_to_master.py

â¸»

â­ 3.5.1 Review + Refactor Existing Scrapers

You mentioned:
	â€¢	stock_scraper.py
	â€¢	stock_scraper_fixed.py
	â€¢	bse_scraper.py (if exists)

We create a clean unified scraper layer.

âœ”ï¸ Tasks
	â€¢	Identify all existing scraper files
	â€¢	Migrate to queen/scrapers/
	â€¢	Remove duplicate logic
	â€¢	Add error-handling + retries
	â€¢	Replace â€œquick hacksâ€ with structured schema
	â€¢	Add proper logging
	â€¢	Add fast caching + last-updated timestamps

â¸»

â­ 3.5.2 Standardize Output Schema

Your desired schema:

{
  "symbol": "SBIN",
  "isin": "INE062A01020",
  "as_of": "2025-11-20",
  "roe_3yr": 14.2,
  "roce_3yr": 15.1,
  "debt_to_equity": 0.8,
  "sales_cagr_5yr": 12.4,
  "profit_cagr_5yr": 10.8,
  "opm_5yr_avg": 18.2,
  "npm_5yr_avg": 9.5,
  "fii_holding_pct": 10.3,
  "dii_holding_pct": 32.1,
  "pledged_pct": 0.0
}

âœ”ï¸ Build schema validator
	â€¢	Validate float fields
	â€¢	Validate percentages
	â€¢	Validate trend metrics
	â€¢	Set defaults for missing data
	â€¢	Add fundamental_ok boolean at end

â¸»

â­ 3.5.3 Save Raw + Cleaned Outputs

Queen must follow a 3-layer storage model:

âœ”ï¸ Raw layer

datasets/fundamentals/raw/*.json
	â€¢	Store full scraped JSON
	â€¢	Include timestamp
	â€¢	Include source (NSE/BSE/Screener/Trendlyne/etc.)

âœ”ï¸ Processed layer

datasets/fundamentals/processed/*.parquet
	â€¢	Standardized columns
	â€¢	Cleaned numeric types
	â€¢	Outlier removal
	â€¢	ISIN-consistency check
	â€¢	Normalized for merging

âœ”ï¸ Derived layer

Add derived fields:
	â€¢	roe_trend (3-yr slope)
	â€¢	debt_improving (boolean)
	â€¢	margin_stability_score
	â€¢	growth_consistency_score
	â€¢	quality_score (0â€“100)

â¸»

â­ 3.5.4 Quality Score Engine (0â€“100)

Create: queen/services/fundamental_engine.py

âœ”ï¸ Components

A) Profitability
	â€¢	ROE 3yr
	â€¢	ROCE 3yr
	â€¢	Net Profit Margin
	â€¢	Operating Margin

B) Growth
	â€¢	Sales CAGR 5yr
	â€¢	Profit CAGR 5yr
	â€¢	EPS stability

C) Balance Sheet
	â€¢	Debt/Equity
	â€¢	Pledged shares
	â€¢	Interest coverage

D) Institutional Interest
	â€¢	FII holding
	â€¢	DII holding

E) Risk Flags
	â€¢	Promoter pledging > 5%
	â€¢	Negative 3-year ROE
	â€¢	D/E > 2

âœ”ï¸ Final Score
	â€¢	Weighted composite (you set weights)
	â€¢	Convert into classes:
	â€¢	85â€“100: Excellent
	â€¢	70â€“84: Good
	â€¢	55â€“69: Moderate
	â€¢	< 55: Weak

â¸»

â­ 3.5.5 Integrate Fundamentals With Symbol Master

âœ”ï¸ CLI tool

queen/cli/merge_fundamentals_to_master.py
	â€¢	Merge fundamentals using ISIN
	â€¢	Add fields:
	â€¢	roe_3yr
	â€¢	cagr_5yr
	â€¢	fii_dii_pct
	â€¢	fundamental_ok
	â€¢	quality_score
	â€¢	Mark symbols failing thresholds:
	â€¢	low-quality flag
	â€¢	junk-flag
	â€¢	Save updated master:
	â€¢	active (clean)
	â€¢	delisted
	â€¢	illiquid
	â€¢	junk

â¸»

â­ 3.5.6 Universe Builder Integration

Fundamentals must be a major input into the universe builders:

âœ”ï¸ Intraday universe
	â€¢	Add quality_score weight (5â€“10%)
	â€¢	Exclude junk stocks
	â€¢	Exclude negative-ROE companies

âœ”ï¸ Swing universe
	â€¢	Super important:
	â€¢	Avoid high debt
	â€¢	Avoid pledged promoter stocks
	â€¢	Prefer consistent profit growth
	â€¢	Prefer high ROE, high ROCE stocks

âœ”ï¸ Tiering
	â€¢	Tier 1: High quality fundamentals
	â€¢	Tier 2: Medium
	â€¢	Tier 3: Moderate
	â€¢	Exclude weak

â¸»

â­ 3.5.7 Cockpit + API Integration

âœ”ï¸ API endpoints
	â€¢	/fundamentals/{symbol}
	â€¢	/quality/{symbol}
	â€¢	/universe/fundamentals

âœ”ï¸ Cockpit Enhancements
	â€¢	Show fundamentals in summary card
	â€¢	Show quality score
	â€¢	Highlight high-risk financials (red badge)
	â€¢	Show FII+DII holding in tooltip

â¸»

â­ 3.5.8 Batch Scheduler (Automated Updates)

âœ”ï¸ Nightly cron
	â€¢	Scrape fundamentals once a day
	â€¢	Save raw JSON
	â€¢	Process to parquet
	â€¢	Merge into master
	â€¢	Rebuild universe
	â€¢	Trigger notifications if fundamental changes > threshold
	â€¢	Example:
	â€¢	ROE drop
	â€¢	Pledged shares increase
	â€¢	Debt spike

â¸»

â­ 3.5.9 Cross-Integration With Engines

Fundamentals enable:

âœ”ï¸ Swing Engine
	â€¢	High-quality stocks â†’ higher swing conviction
	â€¢	Low-quality stocks â†’ avoid or reduce position size

âœ”ï¸ BTST Engine
	â€¢	Weak fundamentals = high-risk overnight positions

âœ”ï¸ Risk Block
	â€¢	Quality score reduces risk_score
	â€¢	High debt increases risk_score

âœ”ï¸ Trade Validity (BUY/WATCH/AVOID)
	â€¢	AVOID if terrible fundamentals
	â€¢	BUY only if fundamentals pass threshold

â¸»

â­ 3.5.10 Final Output â€” What Queen Gains

After Part 3.5 is completed:

ğŸš€ A complete fundamental database

ğŸš€ Clean integration with symbol master

ğŸš€ Universe builder becomes much stronger

ğŸš€ Swing & BTST become high-quality

ğŸš€ Risk engine becomes massively smarter

ğŸš€ Cockpit gets fundamental health

ğŸš€ Your entire ecosystem becomes institutional-grade

â¸»

Brotherâ€¦

ğŸ Part 3 (Roadmap) is now COMPLETED.

We now have:
	â€¢	Part 3.1 â€” Core Roadmap
	â€¢	Part 3.2 â€” Swing & BTST
	â€¢	Part 3.3 â€” Indicator Library
	â€¢	Part 3.4 â€” Symbol Master
	â€¢	Part 3.5 â€” Fundamentals Pipeline

Everything has been delivered cleanly, in perfect structure.

â¸»

If you want, I can now generate:

A MASTER COMBINED PDF VERSION of Part 1â€“3

or

Begin Phase-1 Implementation (stabilization)

or

Review your codebase files in mapped context

or

Proceed to Tactical engine rewrite

Just tell me:

â€œBuddy, whatâ€™s next?â€
