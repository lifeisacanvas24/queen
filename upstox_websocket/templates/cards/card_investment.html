{# Investment Card Template - Long-term holdings #}
{# Includes Investment Thesis + Valuation + Quality Scores #}

{% extends 'cards/card_base.html' %}

{% block card_content %}
    {# Signal Score / Investment Grade #}
    {% if signal.investment_grade %}
    <div class="signal-score">
        <span class="score-label">Investment Grade</span>
        <div class="score-display">
            <div class="score-bar">
                <div class="score-fill high" style="width: {{ signal.investment_grade_pct | default(90) }}%"></div>
            </div>
            <span class="score-value high">{{ signal.investment_grade }}</span>
        </div>
    </div>
    {% endif %}
    
    {# P&L Box for Core Holdings #}
    {% if signal.holding %}
    <div class="rr-box">
        <div class="rr-item entry">
            <div class="rr-label">Avg Cost</div>
            <div class="rr-value">₹{{ signal.holding.avg_cost | format_price }}</div>
        </div>
        <div class="rr-item pnl {% if signal.holding.pnl_pct < 0 %}negative{% endif %}">
            <div class="rr-label">P&L</div>
            <div class="rr-value">{{ '%+.1f' | format(signal.holding.pnl_pct) }}%</div>
        </div>
        <div class="rr-item ratio">
            <div class="rr-label">Weight</div>
            <div class="rr-value">{{ signal.holding.weight }}%</div>
        </div>
    </div>
    {% endif %}
    
    {# Wyckoff Phase / Long Term Trend #}
    {% if signal.wyckoff_phase %}
    <div class="info-box phase">
        <div class="phase-header">
            <span class="phase-title">{{ 'Long Term Trend' if signal.action == 'CORE' else 'Wyckoff Phase' }}</span>
            <span class="phase-name {{ signal.wyckoff_phase }}">
                {% if signal.action == 'CORE' %}SECULAR BULL{% else %}{{ signal.wyckoff_phase | upper }}{% endif %}
            </span>
        </div>
        <div class="phase-bar">
            <div class="phase-segment acc {% if signal.wyckoff_phase == 'accumulation' %}active{% endif %}" style="width: 25%"></div>
            <div class="phase-segment mkp {% if signal.wyckoff_phase == 'markup' %}active{% endif %}" style="width: 25%"></div>
            <div class="phase-segment dst {% if signal.wyckoff_phase == 'distribution' %}active{% endif %}" style="width: 25%"></div>
            <div class="phase-segment mkd {% if signal.wyckoff_phase == 'markdown' %}active{% endif %}" style="width: 25%"></div>
        </div>
    </div>
    {% endif %}
    
    {# Investment Thesis Context #}
    {% if signal.investment_thesis %}
    <div class="info-box context">
        <div class="box-title">
            <i class="fas {{ 'fa-landmark' if signal.action == 'CORE' else 'fa-info-circle' }}"></i>
            {{ 'Core Holdings Thesis' if signal.action == 'CORE' else 'Investment Thesis' }}
        </div>
        <div class="context-items">
            {% for ctx in signal.investment_thesis %}
            <span class="ctx-item {{ ctx.sentiment }}">
                {% if ctx.icon %}<i class="fas {{ ctx.icon }}"></i>{% endif %}
                {{ ctx.text }}
            </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {# Valuation & Quality Indicators #}
    {% if signal.valuation or signal.quality_score %}
    <div class="indicators-row">
        {% if signal.valuation %}
        <div class="indicator-box">
            <div class="ind-header">
                <span class="ind-label">Valuation</span>
                <span class="ind-value">{{ signal.valuation.label }}</span>
            </div>
            <div class="ind-bar">
                <div class="ind-fill {{ signal.valuation.strength }}" style="width: {{ signal.valuation.pct }}%"></div>
            </div>
        </div>
        {% endif %}
        {% if signal.quality_score %}
        <div class="indicator-box">
            <div class="ind-header">
                <span class="ind-label">Quality Score</span>
                <span class="ind-value">{{ signal.quality_score.label }}</span>
            </div>
            <div class="ind-bar">
                <div class="ind-fill {{ signal.quality_score.strength }}" style="width: {{ signal.quality_score.pct }}%"></div>
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    {# Trade Details - Action Specific #}
    <div class="trade-details">
        {% if signal.action == 'CORE' %}
        <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value special">NEVER SELL - CORE</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Add on Dips</span>
            <span class="detail-value entry">Below ₹{{ signal.add_below | format_price }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">{{ signal.target_horizon | default('10Y') }} Target</span>
            <span class="detail-value target">₹{{ signal.long_term_target | format_price }}+ ({{ signal.target_multiple | default('3x') }})</span>
        </div>
        {% else %}
        {# Accumulate #}
        <div class="detail-row">
            <span class="detail-label">Buy Zone</span>
            <span class="detail-value entry">₹{{ signal.buy_zone }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">12M Target</span>
            <span class="detail-value target">₹{{ signal.target_12m }} ({{ signal.target_12m_pct }})</span>
        </div>
        {% if signal.dividend_yield %}
        <div class="detail-row">
            <span class="detail-label">Dividend Yield</span>
            <span class="detail-value special">~{{ signal.dividend_yield }}% Annual</span>
        </div>
        {% endif %}
        <div class="detail-row">
            <span class="detail-label">Portfolio Weight</span>
            <span class="detail-value special">{{ signal.recommended_weight | default('5-8%') }} Recommended</span>
        </div>
        {% endif %}
    </div>
    
    {# Quality Confidence #}
    {% if signal.quality_confidence %}
    <div class="confidence-section">
        <div class="confidence-header">
            <span class="confidence-label">{{ 'Core Quality' if signal.action == 'CORE' else 'Investment Quality' }}</span>
            <span class="confidence-value">{{ signal.quality_confidence }}</span>
        </div>
        <div class="confidence-bar">
            <div class="confidence-fill high" style="width: {{ signal.quality_confidence_pct | default(90) }}%"></div>
        </div>
    </div>
    {% endif %}
{% endblock %}
