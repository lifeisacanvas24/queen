{% extends "_layouts/base.html" %}
{% block title %}Queen Cockpit — History{% endblock %}
{% set page_id = "history" %}

{% block top %}
<h1 class="title">
  Queen Cockpit — <span class="q-muted">History</span>
  <span id="sessionBadge" class="session-badge">—</span>
</h1>
{% endblock %}

{% block content %}
<div class="q-box p-4">

  <!-- Header -->
  <div class="is-flex is-justify-content-space-between is-align-items-center mb-4"
       style="flex-wrap:wrap; gap:1rem;">
    <div class="q-muted">Archived signals / events</div>
    <button id="refresh" class="button q-primary">Refresh</button>
  </div>

  <!-- Grid -->
  <div id="histGrid" class="card-grid"></div>

</div>
{% endblock %}

{% block scripts %}
<script>
/* =============================================================
   HISTORY — clean card layout using qs.renderHistoryCards()
   ============================================================= */
async function loadHistory(){
  const gridEl = "histGrid";
  qs.spinGrid(gridEl);

  try {
    const j = await qs.noStore('/cockpit/api/history').then(r=>r.json());
    const rows = Array.isArray(j.rows) ? j.rows : [];
    qs.renderHistoryCards(gridEl, rows);
  } catch (e){
    qs.errorGrid(gridEl, e);
  }
}

/* -------------------------------------------------------------
   Wire events
   ------------------------------------------------------------- */
window.addEventListener('load', ()=>{
  document.getElementById('refresh').onclick = loadHistory;
  loadHistory();
  qs.initSessionBadge && qs.initSessionBadge("sessionBadge");
});
</script>
{% endblock %}
