Brother‚Ä¶
We now enter the most important chapter:

üìï PART 2 ‚Äî QUEEN WEAKNESS MAP (FULL DIAGNOSTIC)

This is not criticism ‚Äî this is architecture truth.
This is what allows Queen to be stable, predictable, scalable, and future-proof.

I will be 100% honest, precise, and constructive.

Let‚Äôs begin.

‚∏ª

SECTION 1 ‚Äî SYSTEM-LEVEL WEAKNESSES

1.1 No single source of truth (SSOT)

Queen has multiple overlapping files computing similar concepts:
	‚Ä¢	CPR state appears in 3 places
	‚Ä¢	VWAP state appears in 2 places
	‚Ä¢	Trend bias is computed in 2‚Äì3 places
	‚Ä¢	Target logic appears in 2 places
	‚Ä¢	SL logic appears in 3 places

This creates fragmentation and inconsistencies.

Effect:
Two modules may disagree on:
	‚Ä¢	CPR label
	‚Ä¢	Trend bias
	‚Ä¢	Entry quality
	‚Ä¢	SL usage
	‚Ä¢	Score
	‚Ä¢	Targets

‚Üí UI becomes inconsistent
‚Üí Actionables differ run-to-run
‚Üí Debugging becomes harder

‚∏ª

1.2 Tactical pipeline is too distributed

TACTICAL logic is spread across many files:

divergence.py
exhaustion.py
absorption.py
liquidity_trap.py
pattern_fusion.py
reversal_stack.py
squeeze_pulse.py
pre_breakout.py
pattern_tactical_chain.py
tactical_meta_dashboard.py
utils_patterns.py

There is no single central fusion engine.

Effect:
Signals sometimes contradict each other.
No deterministic order of evaluation.
Scores delivered by TACMOD A + TACMOD B are not fused properly.

‚∏ª

1.3 Scoring Engine is fragmented / implicit

The scoring layer:
	‚Ä¢	Exists across scoring rules, cockpit_row, bible, tactical, alignment, validity.
	‚Ä¢	There is no unified, explicit scoring engine file.
	‚Ä¢	Cockpit UI expects fields like:
	‚Ä¢	score
	‚Ä¢	trend_score
	‚Ä¢	tactical_index
	‚Ä¢	early
	‚Ä¢	urgency
	‚Ä¢	decision, etc.

But these are not coming from one controlled place.

Effect:
Scores vary drastically depending on which module is called first.

This is the #1 cause of:
	‚Ä¢	mismatch between ‚ÄúBUY‚Äù in Bible vs ‚ÄúWATCH‚Äù in Tactical
	‚Ä¢	mismatch between Score shown vs score used internally
	‚Ä¢	unpredictable UI card ordering

‚∏ª

1.4 live.py CMP ‚Üî indicator mismatch

You already noticed the problem.

live.py often overrides CMP AFTER indicators are computed.

This breaks:
	‚Ä¢	VWAP
	‚Ä¢	CPR
	‚Ä¢	Trend
	‚Ä¢	RSI
	‚Ä¢	ATR
	‚Ä¢	Targets
	‚Ä¢	Entry geometry

Effect:
Scores and decisions change incorrectly based on CMP override.

Good that we planned the fix for v9.6.0 but this still requires
refactoring across cockpit_row, bible_engine, live.py, ladder.

‚∏ª

1.5 Ladder and Tactical are disconnected

Ladder v1.4 (WRB runner) is perfect mathematically, BUT‚Ä¶

It is not integrated with Tactical or Bible.

That means:
	‚Ä¢	Tactical breakout may happen but Ladder stays Stage 0
	‚Ä¢	Ladder Stage 3 may activate but Tactical is bearish
	‚Ä¢	Trail SL may contradict SL from pre-breakout pattern

Effect:
Inconsistent entry/exit logic
(Real traders hate inconsistency ‚Äî this kills confidence.)

‚∏ª

1.6 Bible blocks sometimes contradict Tactical

Examples:

Issue A

Bible ‚Üí ‚ÄúStructure: SPS, Trend: Bullish‚Äù
but Tactical ‚Üí Liquidity Trap (bearish), Exhaustion, RSI divergence

Issue B

Bible ‚Üí BUY
but Tactical ‚Üí Mid-stage down-drift

Issue C

Bible ‚Üí Near CPR (ready)
but Tactical ‚Üí Too much volatility (avoid)

This is structural contradiction.

Effect:
The user sees BUY in one place and WATCH in another ‚Üí confusion.

‚∏ª

1.7 Cockpit UI strongly depends on unstable backend schema

The JS modules assume:

row.score
row.early
row.decision
row.targets_state.*
row.entry
row.sl
row.vwap_ctx
row.cpr_ctx
row.notes
row.action

But backend does NOT always provide these fields uniformly.

Effect:
UI sometimes:
	‚Ä¢	fails to show targets
	‚Ä¢	shows empty SL
	‚Ä¢	shows ‚Äúundefined‚Äù in notes
	‚Ä¢	mis-renders CPR/VWAP

‚∏ª

1.8 Alert engine not fully integrated with tactical rules

alert_daemon.py reads from limitation:
	‚Ä¢	Only price alerts
	‚Ä¢	Only indicator rules
	‚Ä¢	Only pattern alerts
	‚Ä¢	Tactical alerts missing
	‚Ä¢	Ladder runner alerts missing
	‚Ä¢	Entry-breakout alerts missing

Effect:
Not all tactical conditions show up in alerts panel.

‚∏ª

1.9 Universe scanner not optimized

symbol_scan.py, universe_scanner.py, and morning_intel.py perform repeated:
	‚Ä¢	full DF fetch
	‚Ä¢	repeated indicator calculation
	‚Ä¢	repeated bible calculation

Effect:
Redundant compute ‚Üí slow performance
Wasted API calls
Same symbol processed multiple times

‚∏ª

1.10 AI layer disconnected

Meta/AI code is present but not wired in:

Files like:

ai_inference.py
ai_optimizer.py
ai_recommender.py
ai_trainer.py
cognitive_orchestrator.py
meta_controller.py
meta_introspector.py

contain placeholders but no pipeline integration.

This is fine for future v11, but right now it‚Äôs ‚Äúdead code‚Äù.

‚∏ª

SECTION 2 ‚Äî MODULE-LEVEL WEAKNESSES

2.1 Indicators: inconsistent naming

Example:
	‚Ä¢	EMA20 vs ema20 vs EMA_20
	‚Ä¢	ATR vs atr vs atr_intraday
	‚Ä¢	CPR Context vs CPR_Ctx vs cpr_ctx
	‚Ä¢	VWAP_Zone vs vwap_zone
	‚Ä¢	CPR value sometimes is a float, sometimes dict

This must be normalized.

‚∏ª

2.2 Tactical modules lack shared context

Each tactical file uses different input structures.

Example:

squeeze_pulse.py expects different fields than
reversal_stack.py.

This is fragile.

‚∏ª

2.3 bible_engine.py near-ready but not pure

trade_validity_block mixes:
	‚Ä¢	CMP geometry
	‚Ä¢	CPR/VWAP state
	‚Ä¢	Trend_Bias
	‚Ä¢	Risk_Rating
	‚Ä¢	Tactical_Index
	‚Ä¢	ReversalScore
	‚Ä¢	UC/LC
	‚Ä¢	CPR reclaim logic

This block tries to be both:
	‚Ä¢	scorer
	‚Ä¢	filter
	‚Ä¢	decision-maker
	‚Ä¢	geometry evaluator

It should instead be post-scoring filter.

‚∏ª

2.4 cockpit_row.py too overloaded

This file:
	‚Ä¢	formats text
	‚Ä¢	computes targets
	‚Ä¢	aligns decisions
	‚Ä¢	enriches metadata
	‚Ä¢	applies tactical/bible
	‚Ä¢	builds SL/entry geometry

This violates separation of concerns.

‚∏ª

2.5 live.py over-responsible

live.py:
	‚Ä¢	fetches data
	‚Ä¢	computes indicators
	‚Ä¢	computes tactical
	‚Ä¢	computes bible
	‚Ä¢	computes scoring
	‚Ä¢	applies ladder
	‚Ä¢	builds cockpit rows
	‚Ä¢	handles CMP override
	‚Ä¢	handles timeline state
	‚Ä¢	maps columns
	‚Ä¢	filters universe

This file is the cause of several bugs.

‚∏ª

2.6 Ladder needs formal integration

Right now Ladder is only used in:
	‚Ä¢	actionables_for
	‚Ä¢	cockpit_row

It should be used by:
	‚Ä¢	scoring
	‚Ä¢	bible
	‚Ä¢	tactical
	‚Ä¢	alerts

‚∏ª

2.7 Portfolio & PnL flow incomplete

Seen in:

portfolio.py
pnl.py
live_portfolio UI

Issues:
	‚Ä¢	PnL uses mid-price
	‚Ä¢	No integration with ladder stage
	‚Ä¢	No integration with tactical warnings
	‚Ä¢	No risk-based sizing

‚∏ª

2.8 Validation missing

validate_registry.py mostly checks registry, but does not verify:
	‚Ä¢	Missing indicators
	‚Ä¢	Broken tactical chains
	‚Ä¢	UI contract mismatch
	‚Ä¢	Scoring contract
	‚Ä¢	Ladder alignment

‚∏ª

SECTION 3 ‚Äî UX & USER-FLOW WEAKNESSES

3.1 Inconsistent decision labels

Examples:
	‚Ä¢	‚ÄúBUY ‚Äî Clean intraday setup‚Äù
	‚Ä¢	‚ÄúWATCH ‚Äî Constructive but unready‚Äù
	‚Ä¢	‚ÄúAVOID ‚Äî Bearish trend‚Äù
	‚Ä¢	‚ÄúAvoid ‚Äî Too choppy‚Äù

Capitalization & wording differ.

‚∏ª

3.2 UI sorting depends on score but score unstable

This causes random reorderings
(literally changes every refresh).

‚∏ª

3.3 Early-score is calculated differently in beams

Pre-breakout logic is repeated across modules.

‚∏ª

3.4 Session badge inaccurate

Session badge uses:
	‚Ä¢	local clock
	‚Ä¢	but no integration with NSE holiday calendar
	‚Ä¢	pre-open & post-market not considered

‚∏ª

SECTION 4 ‚Äî ENGINE FRAGILITIES

4.1 Multi-interval logic weak

If 5m signals strong but 15m is weak ‚Üí confusion.

There is no unified multi-timeframe fusion.

‚∏ª

4.2 CMP source inconsistency

Sometimes:
	‚Ä¢	CMP comes from last candle
	‚Ä¢	Sometimes from live override
	‚Ä¢	Sometimes from previous DF

A big source of inconsistencies.

‚∏ª

4.3 Exception handling weak

More try/except needed around:
	‚Ä¢	indicator missing
	‚Ä¢	tactical module crash
	‚Ä¢	scoring exceptions
	‚Ä¢	IO failure
	‚Ä¢	API failure
	‚Ä¢	Polars errors

‚∏ª

SECTION 5 ‚Äî MISSING OR UNDERDEVELOPED PIECES

5.1 Scoring engine main file (critical)

Still missing ‚Äî but we will reconstruct it.

‚∏ª

5.2 Tactical fusion central node

We will build a new tactical fusion architecture:

[Signals] ‚Üí [Fusion] ‚Üí [Tactical Index]


‚∏ª

5.3 Risk-based position sizing

Currently missing.

‚∏ª

5.4 Pre-market & after-market mode

Missing.

‚∏ª

5.5 Logging & tracing

Need unified JSONL logs.

‚∏ª

CONCLUSION OF PART 2

Brother‚Ä¶

This is the truth map ‚Äî
everything that must be fixed, unified, or refactored
to make Queen rock-solid.

No emotion.
No judgement.
Just engineering truth.

And now‚Ä¶

We get to the exciting part.

‚∏ª

üëâ Say ‚ÄúBuddy, start Part 3 ‚Äî Roadmap.‚Äù
